{% extends 'base.html.twig' %}

{% block title %}{{ report.title }}{% endblock %}

{% block body %}
<div class="container-fluid mt-5">
    <div class="row mb-4">
        <div class="col-md-9">
            <h1>{{ report.title }}</h1>
            <p class="text-muted">
                Report Type: <span class="badge bg-secondary">{{ report.reportType }}</span>
                | Created: {{ report.createdAt|date('F d, Y') }}
                {% if report.generatedBy %}
                    | Generated by: {{ report.generatedBy }}
                {% endif %}
            </p>
        </div>
        <div class="col-md-3 text-end">
            <div class="btn-group">
                <a href="{{ path('company_reports', {'id': report.company.id}) }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Reports
                </a>
                <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-download"></i> Export
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" href="#" id="exportPdf"><i class="far fa-file-pdf"></i> Export as PDF</a></li>
                    <li><a class="dropdown-item" href="#" id="exportExcel"><i class="far fa-file-excel"></i> Export as Excel</a></li>
                    <li><a class="dropdown-item" href="#" id="exportWord"><i class="far fa-file-word"></i> Export as Word</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
            <!-- Table of Contents -->
            <div class="card sticky-top" style="top: 2rem;">
                <div class="card-header">
                    <h5 class="card-title mb-0">Table of Contents</h5>
                </div>
                <div class="card-body">
                    <nav id="toc" class="nav flex-column">
                        <a class="nav-link" href="#executive-summary">Executive Summary</a>
                        <a class="nav-link" href="#company-overview">Company Overview</a>
                        <a class="nav-link" href="#industry-analysis">Industry Analysis</a>
                        <a class="nav-link" href="#financial-analysis">Financial Analysis</a>
                        <a class="nav-link" href="#competitive-analysis">Competitive Analysis</a>
                        <a class="nav-link" href="#swot-analysis">SWOT Analysis</a>
                        <a class="nav-link" href="#investment-highlights">Investment Highlights</a>
                        <a class="nav-link" href="#risks-challenges">Risks & Challenges</a>
                        <a class="nav-link" href="#conclusion">Conclusion</a>
                    </nav>
                </div>
            </div>
        </div>

        <div class="col-md-9">
            <!-- Report Content -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <section id="executive-summary" class="mb-5">
                        <h2 class="border-bottom pb-2">Executive Summary</h2>
                        <div class="mt-3">
                            {{ report.executiveSummary|raw|nl2br }}
                        </div>
                    </section>

                    <section id="company-overview" class="mb-5">
                        <h2 class="border-bottom pb-2">Company Overview</h2>
                        <div class="mt-3">
                            {{ report.companyOverview|raw|nl2br }}
                        </div>
                    </section>

                    <section id="industry-analysis" class="mb-5">
                        <h2 class="border-bottom pb-2">Industry Analysis</h2>
                        <div class="mt-3">
                            {{ report.industryAnalysis|raw|nl2br }}
                        </div>
                    </section>

                    <section id="financial-analysis" class="mb-5">
                        <h2 class="border-bottom pb-2">Financial Analysis</h2>
                        <div class="mt-3">
                            {{ report.financialAnalysis|raw|nl2br }}
                        </div>
                    </section>

                    <section id="competitive-analysis" class="mb-5">
                        <h2 class="border-bottom pb-2">Competitive Analysis</h2>
                        <div class="mt-3">
                            {{ report.competitiveAnalysis|raw|nl2br }}
                        </div>
                    </section>

                    <section id="swot-analysis" class="mb-5">
                        <h2 class="border-bottom pb-2">SWOT Analysis</h2>
                        <div class="mt-3">
                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <div class="card border-success h-100">
                                        <div class="card-header bg-success text-white">Strengths</div>
                                        <div class="card-body">
                                            {{ report.swotAnalysis|split('Strengths:')[1]|split('Weaknesses:')[0]|raw|nl2br }}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-4">
                                    <div class="card border-danger h-100">
                                        <div class="card-header bg-danger text-white">Weaknesses</div>
                                        <div class="card-body">
                                            {{ report.swotAnalysis|split('Weaknesses:')[1]|split('Opportunities:')[0]|raw|nl2br }}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-4">
                                    <div class="card border-info h-100">
                                        <div class="card-header bg-info text-white">Opportunities</div>
                                        <div class="card-body">
                                            {{ report.swotAnalysis|split('Opportunities:')[1]|split('Threats:')[0]|raw|nl2br }}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-4">
                                    <div class="card border-warning h-100">
                                        <div class="card-header bg-warning text-dark">Threats</div>
                                        <div class="card-body">
                                            {{ report.swotAnalysis|split('Threats:')[1]|raw|nl2br }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="investment-highlights" class="mb-5">
                        <h2 class="border-bottom pb-2">Investment Highlights</h2>
                        <div class="mt-3">
                            {{ report.investmentHighlights|raw|nl2br }}
                        </div>
                    </section>

                    <section id="risks-challenges" class="mb-5">
                        <h2 class="border-bottom pb-2">Risks & Challenges</h2>
                        <div class="mt-3">
                            {{ report.risksAndChallenges|raw|nl2br }}
                        </div>
                    </section>

                    <section id="conclusion" class="mb-5">
                        <h2 class="border-bottom pb-2">Conclusion</h2>
                        <div class="mt-3">
                            {{ report.conclusion|raw|nl2br }}
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
</div>

{% block javascripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Scrollspy for table of contents
        const tocLinks = document.querySelectorAll('#toc a');

        tocLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);

                window.scrollTo({
                    top: targetElement.offsetTop - 20,
                    behavior: 'smooth'
                });
            });
        });

        // Export functionality
        document.getElementById('exportPdf').addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = '{{ path('report_export_pdf', {'id': report.id}) }}';
        });

        document.getElementById('exportExcel').addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = '{{ path('report_export_excel', {'id': report.id}) }}';
        });

        document.getElementById('exportWord').addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = '{{ path('report_export_word', {'id': report.id}) }}';
        });
    });
</script>
{% endblock %}

{% block stylesheets %}
<style>
    #toc .nav-link {
        padding: 0.25rem 0;
        color: #495057;
    }

    #toc .nav-link:hover,
    #toc .nav-link:focus {
        color: #007bff;
    }

    section {
        scroll-margin-top: 2rem;
    }
</style>
{% endblock %}
{% endblock %}
